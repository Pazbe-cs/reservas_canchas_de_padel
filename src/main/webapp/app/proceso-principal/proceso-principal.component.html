<div class="container-fluid mt-4 proceso-principal">
  <div class="mb-4">
    <h2 class="fw-bold mb-1">Panel de Reservas</h2>
    <span class="text-muted">Gestión de reservas y pagos</span>
  </div>

  <!-- Tarjetas -->
  <div class="row g-3 mb-4">
    <div class="col-md-4" *ngFor="let tarjeta of tarjetas">
      <div class="card tarjeta-resumen h-100" [ngClass]="'tarjeta-' + tarjeta.color">
        <div class="card-body">
          <h6 class="card-title text-uppercase">{{ tarjeta.titulo }}</h6>
          <h2 class="fw-bold mb-1">{{ tarjeta.valor }}</h2>
          <small>{{ tarjeta.descripcion }}</small>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <!-- FORMULARIO -->
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white fw-semibold">
          Registrar reserva
        </div>

        <div class="card-body">
          <form (ngSubmit)="registrarReserva()">
            <div class="mb-3">
              <label class="form-label">Cliente</label>
              <select class="form-select" [(ngModel)]="usuarioIdSeleccionado" name="usuarioId" required>
                <option [ngValue]="null">Seleccionar cliente...</option>
                <option *ngFor="let u of usuarios" [ngValue]="u.id">
                  {{ u.nombre }} <span *ngIf="u.telefono">- {{ u.telefono }}</span>
                </option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Cancha</label>
              <select class="form-select" [(ngModel)]="canchaIdSeleccionada" name="canchaId" required>
                <option [ngValue]="null">Seleccionar cancha...</option>
                <option [ngValue]="1">Cancha 1</option>
                <option [ngValue]="2">Cancha 2</option>
                <option [ngValue]="3">Cancha 3</option>
                <option [ngValue]="4">Cancha 4</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Fecha</label>
              <input type="date" class="form-control" [(ngModel)]="fechaSeleccionada" name="fecha" required />
            </div>

            <div class="row g-2">
              <div class="col-6">
                <label class="form-label">Hora inicio</label>
                <input type="time" class="form-control" [(ngModel)]="horaInicioSeleccionada" name="horaInicio" required />
              </div>
              <div class="col-6">
                <label class="form-label">Hora fin</label>
                <input type="time" class="form-control" [(ngModel)]="horaFinSeleccionada" name="horaFin" required />
              </div>
            </div>

            <button type="submit" class="btn btn-primary w-100 mt-3">
              Registrar reserva
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- TABLA -->
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white fw-semibold">
          Reservas recientes
        </div>

        <div class="table-responsive">
          <table class="table table-hover mb-0 align-middle">
            <thead class="table-light">
              <tr>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Cancha</th>
                <th>Horario</th>
                <th class="text-center">Pagó</th>
                <th class="text-center">Estado</th>
                <th class="text-end">Acción</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let r of ultimasReservas">
                <td>{{ r.fecha }}</td>
                <td>{{ r.cliente }}</td>
                <td>{{ r.cancha }}</td>
                <td>{{ r.horario }}</td>

                <td class="text-center">
                  <span class="badge" [ngClass]="r.pagado ? 'bg-success' : 'bg-warning text-dark'">
                    {{ r.pagado ? 'Sí' : 'No' }}
                  </span>
                </td>

                <td class="text-center">
                  <span class="badge"
                        [ngClass]="{
                          'bg-success': r.estado === 'Confirmada',
                          'bg-secondary': r.estado === 'Pendiente'
                        }">
                    {{ r.estado }}
                  </span>
                </td>

                <td class="text-end">
                  <button
                    class="btn btn-sm"
                    [ngClass]="r.pagado ? 'btn-outline-secondary' : 'btn-success'"
                    (click)="abrirPago(r)"
                    [disabled]="r.pagado"
                  >
                    {{ r.pagado ? 'Pagado' : 'Pagar' }}
                  </button>
                </td>
              </tr>

              <tr *ngIf="ultimasReservas.length === 0">
                <td colspan="7" class="text-center text-muted py-4">
                  No hay reservas registradas.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
